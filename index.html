<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Parallel Lite - Rooms</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        :root { --bg: #0d1117; --card: #161b22; --green: #238636; --blue: #1f6feb; --text: #c9d1d9; }
        body { font-family: sans-serif; background: var(--bg); color: var(--text); display: flex; justify-content: center; padding: 20px; }
        .container { background: var(--card); padding: 20px; border-radius: 15px; width: 100%; max-width: 400px; border: 1px solid #30363d; text-align: center; }
        
        input { width: 90%; padding: 12px; margin: 10px 0; border-radius: 8px; border: 1px solid #30363d; background: #0d1117; color: white; }
        
        .btn-box { display: flex; gap: 10px; margin-top: 10px; }
        button { flex: 1; padding: 12px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; color: white; }
        
        .create-btn { background: var(--green); }
        .join-btn { background: var(--blue); }
        
        #status-area { margin: 20px 0; padding: 10px; border-radius: 8px; background: #0d1117; font-size: 0.9em; border: 1px dashed #30363d; }
        .pulse { height: 10px; width: 10px; background: #3fb950; border-radius: 50%; display: inline-block; margin-right: 5px; animation: blink 1s infinite; }
        @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; } }
    </style>
</head>
<body>

<div class="container">
    <h2>Parallel Lite üéôÔ∏è</h2>
    
    <input type="text" id="room-input" placeholder="Enter Room Name (e.g., dosti123)">
    
    <div class="btn-box">
        <button class="create-btn" onclick="initRoom('create')">CREATE ROOM</button>
        <button class="join-btn" onclick="initRoom('join')">JOIN ROOM</button>
    </div>

    <div id="status-area">
        <div id="status">Enter a room name to start</div>
    </div>

    <p style="font-size: 0.8em; color: #8b949e;">Share the Room Name with friends. Both must use the SAME name.</p>
</div>

<audio id="remote-audio" autoplay></audio>

<script>
    let peer = null;
    let conn = null;

    function initRoom(mode) {
        const roomName = document.getElementById('room-input').value;
        if (!roomName) return alert("Pehle Room ka naam likho!");

        // Mode 'create' means you are the host, 'join' means you connect to host
        // To make it simple, we use "RoomName-Host" for the creator
        const hostID = "room-" + roomName;

        if (mode === 'create') {
            // Create the room with a fixed ID
            peer = new Peer(hostID);
            document.getElementById('status').innerHTML = `<span class="pulse"></span> Room Created: <b>${roomName}</b><br>Waiting for friends...`;
            
            peer.on('open', (id) => console.log("Room ID: " + id));

            // Listen for calls
            peer.on('call', (call) => {
                navigator.mediaDevices.getUserMedia({ audio: true }).then(stream => {
                    call.answer(stream);
                    call.on('stream', remoteStream => {
                        document.getElementById('remote-audio').srcObject = remoteStream;
                        document.getElementById('status').innerText = "Friend Joined! Speaking...";
                    });
                });
            });

            peer.on('error', (err) => {
                if(err.type === 'unavailable-id') alert("Ye Room Name pehle se kisi ne le rakha hai!");
            });

        } else {
            // Join existing room
            peer = new Peer(); // Random ID for joiner
            document.getElementById('status').innerText = "Connecting to room...";

            peer.on('open', () => {
                navigator.mediaDevices.getUserMedia({ audio: true }).then(stream => {
                    const call = peer.call(hostID, stream);
                    call.on('stream', remoteStream => {
                        document.getElementById('remote-audio').srcObject = remoteStream;
                        document.getElementById('status').innerText = "Joined! In Call üéß";
                    });
                }).catch(err => alert("Mic Error: Use HTTPS link"));
            });
        }
    }
</script>

</body>
</html>
